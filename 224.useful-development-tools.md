# پیوست د: ابزارهای توسعه مفید

در این پیوست، درباره برخی ابزارهای توسعه مفید که پروژه Rust ارائه می‌دهد صحبت می‌کنیم. ما به قالب‌بندی خودکار، روش‌های سریع برای اعمال اصلاحات هشدار، یک لینتر، و ادغام با IDEها خواهیم پرداخت.

## قالب‌بندی خودکار با rustfmt

ابزار `rustfmt` کد شما را طبق سبک کد جامعه بازفرمت می‌کند. بسیاری از پروژه‌های همکاری‌محور از `rustfmt` استفاده می‌کنند تا از بحث درباره اینکه کدام سبک برای نوشتن Rust استفاده شود جلوگیری کنند: همه کد خود را با استفاده از این ابزار قالب‌بندی می‌کنند.

نصب‌های Rust به‌صورت پیش‌فرض شامل `rustfmt` هستند، بنابراین باید برنامه‌های `rustfmt` و `cargo-fmt` را روی سیستم خود داشته باشید. این دو دستور مشابه `rustc` و `cargo` هستند، به این معنا که `rustfmt` کنترل دقیق‌تری ارائه می‌دهد و `cargo-fmt` قراردادهای یک پروژه که از Cargo استفاده می‌کند را درک می‌کند. برای قالب‌بندی هر پروژه Cargo، دستور زیر را وارد کنید:

```bash
$ cargo fmt
```

اجرای این دستور تمام کد Rust در crate فعلی را بازفرمت می‌کند. این باید تنها سبک کد را تغییر دهد، نه معناشناسی کد.

این دستور به شما `rustfmt` و `cargo-fmt` را می‌دهد، مشابه اینکه Rust هم `rustc` و هم `cargo` را ارائه می‌دهد. برای قالب‌بندی هر پروژه Cargo، دستور زیر را وارد کنید:

```bash
$ cargo fmt
```

اجرای این دستور تمام کد Rust در crate فعلی را بازفرمت می‌کند. این باید تنها سبک کد را تغییر دهد، نه معناشناسی کد. برای اطلاعات بیشتر درباره `rustfmt`، مستندات آن را ببینید.

## اصلاح کد با rustfix

ابزار `rustfix` با نصب‌های Rust ارائه می‌شود و می‌تواند به‌صورت خودکار هشدارهای کامپایلری را که راه‌حل واضحی برای اصلاح مشکل دارند و احتمالاً همان چیزی است که شما می‌خواهید، برطرف کند. احتمالاً قبلاً هشدارهای کامپایلر را دیده‌اید. به‌عنوان مثال، این کد را در نظر بگیرید:

**فایل: src/main.rs**

```rust
fn main() {
    let mut x = 42;
    println!("{x}");
}
```

در اینجا، ما متغیر `x` را به‌عنوان قابل تغییر تعریف کرده‌ایم، اما هرگز آن را تغییر نمی‌دهیم. Rust درباره این موضوع به ما هشدار می‌دهد:

```bash
$ cargo build
   Compiling myprogram v0.1.0 (file:///projects/myprogram)
warning: variable does not need to be mutable
 --> src/main.rs:2:9
  |
2 |     let mut x = 0;
  |         ----^
  |         |
  |         help: remove this `mut`
  |
  = note: `#[warn(unused_mut)]` on by default
```

هشدار پیشنهاد می‌دهد که کلمه کلیدی `mut` را حذف کنیم. ما می‌توانیم این پیشنهاد را با استفاده از ابزار `rustfix` با اجرای دستور `cargo fix` به‌صورت خودکار اعمال کنیم:

```bash
$ cargo fix
    Checking myprogram v0.1.0 (file:///projects/myprogram)
      Fixing src/main.rs (1 fix)
    Finished dev [unoptimized + debuginfo] target(s) in 0.59s
```

وقتی دوباره به `src/main.rs` نگاه کنیم، خواهیم دید که `cargo fix` کد را تغییر داده است:

**فایل: src/main.rs**

```rust
fn main() {
    let x = 42;
    println!("{x}");
}
```

متغیر `x` حالا غیرقابل تغییر است، و هشدار دیگر ظاهر نمی‌شود.

شما همچنین می‌توانید از دستور `cargo fix` برای انتقال کد خود بین نسخه‌های مختلف Rust استفاده کنید. نسخه‌ها در پیوست E پوشش داده شده‌اند.

## لینت‌های بیشتر با Clippy

ابزار `Clippy` مجموعه‌ای از لینت‌ها برای تحلیل کد شما است تا بتوانید اشتباهات رایج را شناسایی کرده و کد Rust خود را بهبود دهید. Clippy با نصب‌های استاندارد Rust ارائه می‌شود.

برای اجرای لینت‌های Clippy روی هر پروژه Cargo، دستور زیر را وارد کنید:

```bash
$ cargo clippy
```

به‌عنوان مثال، فرض کنید برنامه‌ای می‌نویسید که از تقریبی از یک ثابت ریاضی، مانند پی، استفاده می‌کند، همان‌طور که این برنامه انجام می‌دهد:

**فایل: src/main.rs**

```rust
fn main() {
    let x = 3.1415;
    let r = 8.0;
    println!("مساحت دایره {} است", x * r * r);
}
```

اجرای `cargo clippy` روی این پروژه منجر به این خطا می‌شود:

```bash
error: approximate value of `f{32, 64}::consts::PI` found
 --> src/main.rs:2:13
  |
2 |     let x = 3.1415;
  |             ^^^^^^
  |
  = note: `#[deny(clippy::approx_constant)]` on by default
  = help: consider using the constant directly
  = help: for further information visit https://rust-lang.github.io/rust-clippy/master/index.html#approx_constant
```

این خطا به شما اطلاع می‌دهد که Rust قبلاً یک ثابت PI دقیق‌تر تعریف کرده است، و برنامه شما اگر به‌جای آن از ثابت استفاده کند، صحیح‌تر خواهد بود. سپس کد خود را تغییر می‌دهید تا از ثابت PI استفاده کند. کد زیر هیچ خطا یا هشداری از Clippy ایجاد نمی‌کند:

**فایل: src/main.rs**

```rust
fn main() {
    let x = std::f64::consts::PI;
    let r = 8.0;
    println!("مساحت دایره {} است", x * r * r);
}
```

برای اطلاعات بیشتر درباره Clippy، مستندات آن را ببینید.

## ادغام با IDE با استفاده از rust-analyzer

برای کمک به ادغام با IDE، جامعه Rust استفاده از `rust-analyzer` را توصیه می‌کند. این ابزار مجموعه‌ای از ابزارهای متمرکز بر کامپایلر است که از پروتکل سرور زبان (Language Server Protocol) استفاده می‌کند، که یک مشخصات برای ارتباط IDEها و زبان‌های برنامه‌نویسی با یکدیگر است. مشتریان مختلف می‌توانند از `rust-analyzer` استفاده کنند، مانند افزونه Rust analyzer برای Visual Studio Code.

برای دستورالعمل‌های نصب، به صفحه اصلی پروژه `rust-analyzer` مراجعه کنید، سپس پشتیبانی از سرور زبان را در IDE خاص خود نصب کنید. IDE شما قابلیت‌هایی مانند تکمیل خودکار، پرش به تعریف، و خطاهای درون‌خطی به دست خواهد آورد.