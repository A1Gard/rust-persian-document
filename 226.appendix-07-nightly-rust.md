# پیوست G - نحوه ساخت Rust و "Rust شبانه"

این پیوست درباره نحوه ساخت **Rust** و تأثیر آن بر شما به‌عنوان یک توسعه‌دهنده **Rust** است.

## پایداری بدون رکود

به‌عنوان یک زبان، **Rust** بسیار به پایداری کد شما اهمیت می‌دهد. ما می‌خواهیم **Rust** یک پایه محکم باشد که بتوانید روی آن بسازید، و اگر چیزها دائماً تغییر کنند، این امر غیرممکن خواهد بود. در عین حال، اگر نتوانیم با ویژگی‌های جدید آزمایش کنیم، ممکن است تا پس از انتشار، زمانی که دیگر نمی‌توانیم چیزها را تغییر دهیم، نقص‌های مهمی را کشف نکنیم.

راه‌حل ما برای این مشکل چیزی است که ما آن را **"پایداری بدون رکود"** می‌نامیم، و اصل راهنمای ما این است: شما هرگز نباید از ارتقا به نسخه جدید **Rust** پایدار بترسید. هر ارتقا باید بدون دردسر باشد، اما همچنین ویژگی‌های جدید، اشکالات کمتر، و زمان‌های کامپایل سریع‌تری برای شما به ارمغان بیاورد.

## چو، چو! کانال‌های انتشار و سوار شدن بر قطارها

توسعه **Rust** بر اساس یک برنامه قطاری عمل می‌کند. به این معنا که تمام توسعه در شاخه اصلی (master) مخزن **Rust** انجام می‌شود. انتشارها از مدل قطار انتشار نرم‌افزار پیروی می‌کنند که توسط Cisco IOS و دیگر پروژه‌های نرم‌افزاری استفاده شده است. **Rust** دارای سه کانال انتشار است:

- **شبانه (Nightly)**
- **بتا (Beta)**
- **پایدار (Stable)**

اکثر توسعه‌دهندگان **Rust** عمدتاً از کانال پایدار استفاده می‌کنند، اما کسانی که می‌خواهند ویژگی‌های جدید و آزمایشی را امتحان کنند ممکن است از شبانه یا بتا استفاده کنند.

اینجا مثالی از نحوه کار فرآیند توسعه و انتشار آورده شده است: فرض کنیم تیم **Rust** در حال کار روی انتشار **Rust 1.5** است. این انتشار در دسامبر ۲۰۱۵ رخ داد، اما ما از آن برای شماره‌های نسخه واقعی استفاده می‌کنیم. یک ویژگی جدید به **Rust** اضافه می‌شود: یک کامیت جدید در شاخه اصلی فرود می‌آید. هر شب، یک نسخه شبانه جدید از **Rust** تولید می‌شود. هر روز یک روز انتشار است، و این انتشارها توسط زیرساخت انتشار ما به‌صورت خودکار ایجاد می‌شوند. بنابراین با گذشت زمان، انتشارهای ما به این شکل هستند، یک‌بار در شب:

```
شبانه: * - - * - - *
```

هر شش هفته، زمان آماده‌سازی یک انتشار جدید فرا می‌رسد! شاخه بتا از مخزن **Rust** از شاخه اصلی که توسط شبانه استفاده می‌شود جدا می‌شود. حالا دو انتشار وجود دارد:

```
شبانه: * - - * - - *
                     |
بتا:                *
```

اکثر کاربران **Rust** به‌صورت فعال از انتشارهای بتا استفاده نمی‌کنند، اما در سیستم CI خود در برابر بتا تست می‌کنند تا به **Rust** کمک کنند تا رگرسیون‌های احتمالی را کشف کند. در این میان، همچنان هر شب یک انتشار شبانه وجود دارد:

```
شبانه: * - - * - - * - - * - - *
                     |
بتا:                *
```

فرض کنید یک رگرسیون پیدا شود. خوشبختانه ما زمان داشتیم تا انتشار بتا را تست کنیم قبل از اینکه رگرسیون به یک انتشار پایدار نفوذ کند! اصلاح به شاخه اصلی اعمال می‌شود، بنابراین شبانه اصلاح می‌شود، و سپس اصلاح به شاخه بتا بازگردانی می‌شود، و یک انتشار جدید از بتا تولید می‌شود:

```
شبانه: * - - * - - * - - * - - * - - *
                     |
بتا:                * - - - - - - - - *
```

شش هفته پس از ایجاد اولین بتا، زمان انتشار پایدار فرا می‌رسد! شاخه پایدار از شاخه بتا تولید می‌شود:

```
شبانه: * - - * - - * - - * - - * - - * - * - *
                     |
بتا:                * - - - - - - - - *
                                       |
پایدار:                                *
```

هورا! **Rust 1.5** آماده است! با این حال، یک چیز را فراموش کرده‌ایم: چون شش هفته گذشته است، ما همچنین به یک بتای جدید از نسخه بعدی **Rust**، یعنی ۱.۶، نیاز داریم. بنابراین پس از اینکه پایدار از بتا جدا شد، نسخه بعدی بتا دوباره از شبانه جدا می‌شود:

```
شبانه: * - - * - - * - - * - - * - - * - * - *
                     |                         |
بتا:                * - - - - - - - - *       *
                                       |
پایدار:                                *
```

این مدل به نام مدل **قطار** شناخته می‌شود زیرا هر شش هفته، یک انتشار **ایستگاه را ترک می‌کند**، اما همچنان باید سفری از طریق کانال بتا انجام دهد تا به‌عنوان یک انتشار پایدار برسد.

**Rust** هر شش هفته، مانند ساعت، منتشر می‌شود. اگر تاریخ یک انتشار **Rust** را بدانید، می‌توانید تاریخ انتشار بعدی را بدانید: شش هفته بعد. جنبه خوب برنامه‌ریزی انتشارها هر شش هفته این است که قطار بعدی به‌زودی می‌آید. اگر یک ویژگی از یک انتشار خاص جا بماند، نیازی به نگرانی نیست: یکی دیگر در مدت کوتاهی در راه است! این کمک می‌کند تا فشار برای وارد کردن ویژگی‌های احتمالاً ناپخته نزدیک به مهلت انتشار کاهش یابد.

به لطف این فرآیند، همیشه می‌توانید نسخه بعدی **Rust** را بررسی کنید و خودتان تأیید کنید که ارتقا به آن آسان است: اگر یک انتشار بتا به‌درستی کار نکند، می‌توانید آن را به تیم گزارش دهید و قبل از انتشار پایدار بعدی اصلاح شود! خرابی در یک انتشار بتا نسبتاً نادر است، اما `rustc` همچنان یک نرم‌افزار است، و اشکالات وجود دارند.

## زمان نگهداری

پروژه **Rust** از آخرین نسخه پایدار پشتیبانی می‌کند. وقتی یک نسخه پایدار جدید منتشر می‌شود، نسخه قدیمی به پایان عمر (EOL) خود می‌رسد. این به این معناست که هر نسخه برای شش هفته پشتیبانی می‌شود.

## ویژگی‌های ناپایدار

یک نکته دیگر در این مدل انتشار وجود دارد: **ویژگی‌های ناپایدار**. **Rust** از تکنیکی به نام **پرچم‌های ویژگی (feature flags)** استفاده می‌کند تا مشخص کند کدام ویژگی‌ها در یک انتشار خاص فعال هستند. اگر یک ویژگی جدید در حال توسعه فعال باشد، در شاخه اصلی و بنابراین در شبانه فرود می‌آید، اما پشت یک پرچم ویژگی قرار دارد. اگر شما، به‌عنوان کاربر، بخواهید ویژگی در حال توسعه را امتحان کنید، می‌توانید این کار را انجام دهید، اما باید از یک انتشار شبانه **Rust** استفاده کنید و کد منبع خود را با پرچم مناسب حاشیه‌نویسی کنید تا انتخاب کنید.

اگر از یک انتشار بتا یا پایدار **Rust** استفاده می‌کنید، نمی‌توانید از هیچ پرچم ویژگی استفاده کنید. این کلید اصلی است که به ما امکان می‌دهد با ویژگی‌های جدید قبل از اینکه برای همیشه پایدار اعلام شوند، استفاده عملی داشته باشیم. کسانی که می‌خواهند به لبه پیشرفته وارد شوند می‌توانند این کار را انجام دهند، و کسانی که می‌خواهند یک تجربه کاملاً محکم داشته باشند می‌توانند به پایدار بچسبند و بدانند که کدشان خراب نخواهد شد. **پایداری بدون رکود**.

این کتاب فقط شامل اطلاعات درباره ویژگی‌های پایدار است، زیرا ویژگی‌های در حال پیشرفت همچنان در حال تغییر هستند، و مطمئناً بین زمانی که این کتاب نوشته شده و زمانی که در ساخت‌های پایدار فعال می‌شوند، متفاوت خواهند بود. شما می‌توانید مستندات ویژگی‌های فقط شبانه را به‌صورت آنلاین پیدا کنید.

## Rustup و نقش Rust شبانه

**Rustup** تغییر بین کانال‌های مختلف انتشار **Rust** را، چه به‌صورت جهانی و چه برای هر پروژه، آسان می‌کند. به‌صورت پیش‌فرض، شما **Rust** پایدار را نصب‌شده خواهید داشت. برای نصب شبانه، به عنوان مثال:

```bash
$ rustup toolchain install nightly
```

می‌توانید تمام ابزارهای زنجیره‌ای (انتشارهای **Rust** و اجزای مرتبط) که با **rustup** نصب کرده‌اید را ببینید. در اینجا مثالی از کامپیوتر ویندوزی یکی از نویسندگان آورده شده است:

```bash
> rustup toolchain list
stable-x86_64-pc-windows-msvc (default)
beta-x86_64-pc-windows-msvc
nightly-x86_64-pc-windows-msvc
```

همان‌طور که می‌بینید، ابزار زنجیره‌ای پایدار پیش‌فرض است. اکثر کاربران **Rust** بیشتر اوقات از پایدار استفاده می‌کنند. ممکن است بخواهید بیشتر اوقات از پایدار استفاده کنید، اما در یک پروژه خاص از شبانه استفاده کنید، زیرا به یک ویژگی پیشرفته اهمیت می‌دهید. برای این کار، می‌توانید از `rustup override` در پوشه آن پروژه استفاده کنید تا ابزار زنجیره‌ای شبانه را به‌عنوان ابزاری که **rustup** باید هنگام حضور در آن پوشه استفاده کند تنظیم کنید:

```bash
$ cd ~/projects/needs-nightly
$ rustup override set nightly
```

حالا، هر زمان که `rustc` یا `cargo` را در داخل `~/projects/needs-nightly` فراخوانی کنید، **rustup** مطمئن می‌شود که از **Rust** شبانه استفاده می‌کنید، نه پیش‌فرض پایدار شما. این وقتی که پروژه‌های **Rust** زیادی دارید بسیار مفید است!

## فرآیند RFC و تیم‌ها

پس چگونه درباره این ویژگی‌های جدید مطلع می‌شوید؟ مدل توسعه **Rust** از یک فرآیند **درخواست برای کامنت‌ها (RFC)** پیروی می‌کند. اگر بخواهید بهبودی در **Rust** ایجاد کنید، می‌توانید پیشنهادی بنویسید که به آن **RFC** می‌گویند.

هر کسی می‌تواند RFCهایی برای بهبود **Rust** بنویسد، و پیشنهادها توسط تیم **Rust**، که شامل چندین زیرتیم موضوعی است، بررسی و بحث می‌شوند. لیست کاملی از تیم‌ها در وب‌سایت **Rust** وجود دارد، که شامل تیم‌هایی برای هر بخش از پروژه است: طراحی زبان، پیاده‌سازی کامپایلر، زیرساخت، مستندات، و غیره. تیم مناسب پیشنهاد و کامنت‌ها را می‌خواند، کامنت‌ها خود را می‌نویسد، و در نهایت، اجماعی برای پذیرش یا رد ویژگی به دست می‌آید.

اگر ویژگی پذیرفته شود، یک مسئله در مخزن **Rust** باز می‌شود، و کسی می‌تواند آن را پیاده‌سازی کند. شخصی که آن را پیاده‌سازی می‌کند ممکن است اصلاً همان کسی نباشد که ویژگی را پیشنهاد داده است! وقتی پیاده‌سازی آماده شد، در شاخه اصلی پشت یک دروازه ویژگی (feature gate) فرود می‌آید، همان‌طور که در بخش **ویژگی‌های ناپایدار** بحث کردیم.

پس از مدتی، وقتی توسعه‌دهندگان **Rust** که از انتشارهای شبانه استفاده می‌کنند توانستند ویژگی جدید را امتحان کنند، اعضای تیم درباره ویژگی، نحوه عملکرد آن در شبانه بحث می‌کنند و تصمیم می‌گیرند که آیا باید به **Rust** پایدار راه پیدا کند یا نه. اگر تصمیم به ادامه باشد، دروازه ویژگی برداشته می‌شود، و ویژگی حالا پایدار تلقی می‌شود! آن در قطارها به یک انتشار پایدار جدید از **Rust** می‌رسد.

## تأثیر بر توسعه‌دهندگان Rust

به‌عنوان یک توسعه‌دهنده **Rust**، این فرآیند چندین پیامد برای شما دارد:

1. **ارتقاهای بدون دردسر**: مدل قطار تضمین می‌کند که ارتقا به نسخه‌های جدید پایدار **Rust** ایمن و ساده است. شما می‌توانید با اطمینان به نسخه‌های جدیدتر ارتقا دهید، با دانستن اینکه کد موجود شما به احتمال زیاد بدون تغییر کار خواهد کرد.

2. **دسترسی به ویژگی‌های جدید**: اگر می‌خواهید ویژگی‌های پیشرفته را امتحان کنید، می‌توانید به کانال شبانه تغییر کنید و با استفاده از پرچم‌های ویژگی وارد شوید. این انعطاف‌پذیری به شما امکان می‌دهد در لبه تکنولوژی بمانید، در حالی که پایداری را برای پروژه‌های تولیدی حفظ می‌کنید.

3. **مشارکت در جامعه**: فرآیند RFC به این معناست که شما می‌توانید با پیشنهاد ویژگی‌ها یا مشارکت در بحث‌ها در توسعه **Rust** مشارکت کنید. این مدل باز و مبتنی بر جامعه به کاربران اجازه می‌دهد آینده زبان را شکل دهند.

4. **تست با بتا**: استفاده از کانال بتا در سیستم‌های CI شما می‌تواند به شناسایی رگرسیون‌ها قبل از رسیدن به پایدار کمک کند، و به پایداری کلی **Rust** کمک می‌کند.

5. **مدیریت ابزار زنجیره‌ای با Rustup**: **Rustup** مدیریت چندین نسخه **Rust** را ساده می‌کند، و به شما امکان می‌دهد به‌راحتی بین پایدار، بتا، و شبانه برای پروژه‌های مختلف جابه‌جا شوید.

## نتیجه‌گیری

مدل توسعه و انتشار **Rust**، با تأکید بر **پایداری بدون رکود**، تعادل بین ارائه یک پایه قابل اعتماد برای کد شما و امکان آزمایش با ویژگی‌های جدید را برقرار می‌کند. کانال‌های انتشار (پایدار، بتا، و شبانه) و مدل قطار تضمین می‌کنند که ارتقاها قابل پیش‌بینی و بدون دردسر هستند، در حالی که ویژگی‌های ناپایدار از طریق پرچم‌های ویژگی برای کسانی که می‌خواهند در لبه تکنولوژی کار کنند در دسترس هستند. ابزار **Rustup** مدیریت این کانال‌ها را ساده می‌کند، و فرآیند RFC به جامعه امکان می‌دهد تا در شکل‌دهی آینده **Rust** مشارکت کند.

درک این فرآیند به شما کمک می‌کند تا از نسخه‌های **Rust** به‌طور مؤثر استفاده کنید، چه در حال ساخت برنامه‌های تولیدی با پایدار باشید، چه ویژگی‌های جدید را با شبانه آزمایش کنید، یا در توسعه زبان مشارکت کنید. برای اطلاعات بیشتر درباره ویژگی‌های شبانه یا مشارکت در RFCها، وب‌سایت **Rust** و مخزن رسمی را بررسی کنید.